/* αdithep SriNarulα | 11-01-2014 */
var TEST,fs,path,removeman,stream;Accounts.validateNewUser(function(){return!0}),fs=Npm.require("fs"),path=Npm.require("path"),stream=Npm.require("stream"),TEST=new Meteor.Collection("test"),Meteor.methods({insert_human:function(a){var b;return b=DATA.findOne({name:"humans"}),a.human.type=b._id,DATA.insert(a.human)},input_select:function(a){var b,c;return a.input?(c=new Meteor.Collection.ObjectID(a.field),b=DATA.find({$and:[{type:c},{$or:[{name:{$regex:a.input,$options:"i"}},{country:{$regex:a.input,$options:"i"}}]}]},{limit:5,fields:{name:1,country:1}}).fetch(),_.map(b,function(a){return a.str=a._id._str,delete a._id}),b):void 0},save_contact_json:function(){var a,b,c;return a=DATA.findOne({name:"humans"}),b=DATA.find({type:a._id}).fetch(),_.map(b,function(a){return a.type="humans",a}),c=path.join("/Users/Adithep/Desktop/αSys/json","contacts.json"),fs.writeFile(c,JSON.stringify(b),function(a){if(a)throw a;return console.log("done")})}}),Meteor.publish("type",function(){return DATA.find({type:"type"})}),Meteor.publish("list",function(){var a,b;return a=DATA.findOne({name:"contact_button_list",type:"type"}),b=DATA.findOne({name:"initials_list",type:"type"}),DATA.find({$or:[{type:a._id},{type:b._id},{type:"type"}]})}),Meteor.publish("countries_list",function(){var a;return a=DATA.findOne({name:"countries_list",type:"type"}),DATA.find({type:a._id},{sort:{name:1},fields:{name:1,type:1,callingCode:1,cca2:1}})}),Meteor.publish("currency",function(){var a;return a=DATA.findOne({name:"currency",type:"type"}),DATA.find({type:a._id},{sort:{name:1},fields:{name:1,type:1,symbol:1,usd_exchange_rate:1,country:1,"default":1}})}),Meteor.publish("cities_list",function(a){var b;return a.input?(b=new Meteor.Collection.ObjectID(a.field),DATA.find({$and:[{type:b},{$or:[{name:{$regex:a.input,$options:"i"}},{country:{$regex:a.input,$options:"i"}}]}]},{limit:5,fields:{name:1,country:1,type:1}})):void 0}),Meteor.publish("initials_list",function(){var a;return a=DATA.findOne({name:"initials_list",type:"type"}),a?DATA.find({type:a._id}):void 0}),removeman=function(){var a,b;return a=DATA.findOne({name:"contact_button_list"}),b=DATA.findOne({name:"contact_input_list"}),a&&DATA.remove({type:a._id}),b?DATA.remove({type:b._id}):void 0},Meteor.startup(function(){var a,b,c,d,e,f,g,h,i,j;return f=DATA.findOne({name:"contact_button_list",type:"type"}),g=DATA.findOne({name:"initials_list",type:"type"}),h=DATA.findOne({name:"currency",type:"type"}),i=DATA.findOne({name:"countries_list",type:"type"}),0===DATA.find().count()?(j=EJSON.parse(Assets.getText("types.json")),c=EJSON.parse(Assets.getText("countries.json")),a=EJSON.parse(Assets.getText("button_list.json")),d=EJSON.parse(Assets.getText("initials_list.json")),b=EJSON.parse(Assets.getText("cities.json")),e=[],_.map(j,function(a){return e[a.name]=DATA.insert(a),a}),_.map(c,function(a){var b;return b=a.type,a.type=e[b],DATA.insert(a)}),_.map(d,function(a){var b;return b=a.type,a.type=e[b],DATA.insert(a)}),_.map(a,function(a){var b,c;return b=a.type,a.type=e[b],a.select_database&&(c=a.select_database,a.select_database=e[c]),DATA.insert(a)}),_.map(b,function(a){var b,c,d;return b=a.type,c=a.country,d=DATA.findOne({name:c}),a.type=e[b],a.country_id=d._id,DATA.insert(a)}),console.log("Done")):0===DATA.find({type:f._id}).count()?(a=EJSON.parse(Assets.getText("button_list.json")),_.map(a,function(a){var b;return b=DATA.findOne({name:a.type}),a.type=b._id,_.map(a.input,function(a){var b;return a.select_database?(b=DATA.findOne({name:a.select_database}),a.select_database=b._id,void 0):(a.input_select_database&&(b=DATA.findOne({name:a.input_select_database}),a.input_select_database=b._id),void 0)}),DATA.insert(a)}),console.log("button lists inserted")):0===DATA.find({type:g._id}).count()?(d=EJSON.parse(Assets.getText("initials_list.json")),_.map(d,function(a){var b;return b=DATA.findOne({name:a.type}),a.type=b._id,DATA.insert(a)}),console.log("initials lists inserted")):void 0});