/* αdithep SriNarulα | 17-01-2014 */
var ALPHA,α;ALPHA=function(){function a(){}return a.prototype.Module={config:function(a){return{_template:"layout",init:function(){return a.sb.config_router({template:this._template})},destroy:function(){}}},layout:function(a){return{_template:"layout",init:function(){var b;return b=a.sb.init(this),a.sb.map_event(b.events)},"event click #logout":function(){return a.sb.logout()},destroy:function(){}}},home:function(a){return{init:function(){var b;return b=a.sb.init(this),a.sb.map_router(b.routes)},"route home /":function(){},destroy:function(){}}},login:function(a){return{_template:"login",init:function(){var b;return b=a.sb.init(this),a.sb.map_event(b.events),a.sb.map_helpers(b.helpers)},"helper creatingAccount":function(){return a.sb.session_get({p:"creatingAccount"})},"event click #loginform":function(){return a.sb.session_set({p:"creatingAccount",v:!1})},"event click #accountform":function(){return a.sb.session_set({p:"creatingAccount",v:!0})},"event click #createaccount":function(b){var c;return a.sb.session_set({p:"creatingAccount",v:!1}),c={username:b.t.find("#username").value,password:b.t.find("#password").value,email:b.t.find("#email").value,name:b.t.find("#name").value},a.sb.create_account(c)},"event click #login":function(b){var c;return c={username:b.t.find("#username").value,password:b.t.find("#password").value},a.sb.login(c)},"event click #logout":function(){return a.sb.logout()},destroy:function(){}}},module_test:function(a){return{_template:"moduleTest",init:function(){var b;return b=a.sb.init(this),a.sb.map_router(b.routes),a.sb.map_event(b.events),a.sb.map_helpers(b.helpers),a.sb.autorun({actions:this.autorun})},autorun:function(){var b,c;return b=a.sb.session_get({p:"moduleTest-rr"}),null!==document.getElementById("child")&&null!==a.sb.user()?(c=0,a.sb.get_child({p:"#child"}).map(function(){var b;return b=a.sb.get_child({p:this,c:".close"}),a.sb.set_attr({p:b,a:"href",v:""+c}),c++})):void 0},"helper route":function(b){var c,d,e;return e=a.sb.session_get({p:"moduleTest-rr"}),e?(d=e.split("/"),c=void 0===d[2]?""+e+"/"+b.spacebar_arg:0===d[2].length?""+e+b.spacebar_arg:""+e+"-"+b.spacebar_arg):void 0},"route moduletest moduletest/:ll":function(b){var c;return a.sb.session_set({p:"moduleTest-rr",v:Router.current().path}),b.route_this.render("moduleTest"),c={route_params:b.route_this.params.ll},a.sb.routing(c)},"route moduletest moduletest":function(b){return a.sb.session_set({p:"moduleTest-rr",v:Router.current().path}),b.route_this.render("moduleTest"),a.sb.empty_child({element:"#child"})},"event click .click":function(a){return a.e.currentTarget.innerHTML="hello",a.e.currentTarget},destroy:function(){}}},post_lists:function(a){return{_template:"postlists",init:function(){var b;return b=a.sb.init(this),a.sb.map_helpers(b.helpers),a.post={_dep:new Deps.Dependency,_value:[Template.an],get:function(){return this._dep.depend(),this._value},spush:function(a){return this._value.push(a),this._dep.changed()}},a.post},"helper posts":function(){return a.post.get()}}},add_contact:function(a){return{_template:"add_contact",init:function(){var b;return b=a.sb.init(this),a.input=this.reactive_input,a.session=!1,a.INDIVIDUAL=new Meteor.Collection(null,{idGeneration:"MONGO"}),a.COMPANY=new Meteor.Collection(null,{idGeneration:"MONGO"}),a.CITIES=new Meteor.Collection(null,{idGeneration:"MONGO"}),b.routes&&a.sb.map_router(b.routes),b.helpers&&a.sb.map_helpers(b.helpers),b.events&&a.sb.map_event(b.events),b.mcall&&a.sb.mcall(b.mcall),b.subscribe?a.sb.subscribe(b.subscribe):void 0},"subscribe list":function(){var b,c,d;return b=DATA.findOne({"input.select_name":"initials"}),c=DATA.findOne({"input.input_name":"first_name"}),d=DATA.findOne({"input.input_name":"company_name"}),b&&(_.extend(b,{id:b._id}),b=_.omit(b,"_id"),a.INDIVIDUAL.insert(b)),c&&(_.extend(c,{id:c._id}),c=_.omit(c,"_id"),a.INDIVIDUAL.insert(c)),d?(_.extend(d,{id:d._id}),d=_.omit(d,"_id"),a.COMPANY.insert(d)):void 0},"subscribe countries_list":function(){return console.log("countries subscribed")},"subscribe currency":function(){return console.log("currency subscribed")},"route add_contact add_contact/:ll":function(){},"route add_contact add_contact":function(a){return a.route_this.render("add_contact")},"helper company":function(){return a.sb.session_get({p:"company"})},"helper buttons_individual":function(){var a;return a=DATA.findOne({name:"contact_button_list"}),a?DATA.find({$and:[{type:a._id,individual:{$ne:2},input_starting:{$ne:1},select_starting:{$ne:1}}]}):void 0},"helper buttons_company":function(){var a;return a=DATA.findOne({name:"contact_button_list"}),a?DATA.find({$and:[{type:a._id,individual:{$ne:1},input_starting:{$ne:1},select_starting:{$ne:1}}]}):void 0},"helper countries":function(a){return a.spacebar_arg?DATA.find({type:{_str:a.spacebar_arg}}):void 0},"helper date_t":function(){var a,b;return a=new Date,a.setHours(0,-a.getTimezoneOffset(),0,0),b=a.toISOString().substring(0,10)},"helper input_select":function(){return a.CITIES.find()},"helper input_company":function(){return a.COMPANY.find()},"helper input_individual":function(){return a.INDIVIDUAL.find()},"event click .individual":function(){return a.sb.session_set({p:"company",v:!1})},"event click .company":function(){return a.sb.session_set({p:"company",v:!0})},"event focus .input_select":function(a){return""===a.e.currentTarget.value?$(".input_select_box").hide():$(".input_select_box").show()},"event blur .input_select":function(a){""!==a.e.currentTarget.value?($(".blue_color").html()&&(a.e.currentTarget.value=$(".blue_color").html(),a.e.currentTarget.dataset.value=$(".blue_color").data("value")),""===a.e.currentTarget.dataset.value&&(a.e.currentTarget.value="")):(a.e.currentTarget.value="",a.e.currentTarget.dataset.value=""),$(".input_select_box").hide()},"event mouseover .lala_item":function(a){var b;$(".lala_item").removeClass("blue_color"),$(a.e.target).addClass("blue_color"),b=$(a.e.target).html(),$(".input_select").val(b)},"event click .input_select":function(b){var c,d;""!==b.e.currentTarget.value&&($(".input_select_box").show(),c={input:b.e.currentTarget.value,field:b.e.currentTarget.dataset.database},d=Meteor.subscribe("cities_list",c),a.session&&a.session.stop(),a.session=d)},"event keyup .input_select":function(b){var c,d,e;if(40===b.e.which)$(".lala_item").hasClass("blue_color")===!1?$(".input_select_list li:first-child").addClass("blue_color"):$(".blue_color").removeClass("blue_color").next().addClass("blue_color"),c=$(".blue_color").html(),c&&(b.e.currentTarget.value=c);else if(38===b.e.which)$(".lala_item").hasClass("blue_color")===!1?$(".input_select_list li:first-child").addClass("blue_color"):$(".blue_color").removeClass("blue_color").prev().addClass("blue_color"),c=$(".blue_color").html(),c&&(b.e.currentTarget.value=c);else if(13===b.e.which){if($(".lala_item").hasClass("blue_color")&&(d=$(".blue_color").html(),d&&(b.e.currentTarget.value=d,b.e.currentTarget.dataset.value=$(".blue_color").data("value"))),$(".input_select_box").hide(),a.session)return a.session.stop()}else if(27===b.e.which){if(b.e.currentTarget.value="",b.e.currentTarget.dataset.value="",$(".input_select_box").hide(),a.session)return a.session.stop()}else""===b.e.currentTarget.value?$(".input_select_box").hide():$(".input_select_box").show(),""!==b.e.currentTarget.value&&(e={input:b.e.currentTarget.value,field:b.e.currentTarget.dataset.database},Meteor.subscribe("cities_list",e,function(){var c;return d=new Meteor.Collection.ObjectID(b.e.currentTarget.dataset.database),c=DATA.find({$and:[{type:d},{$or:[{name:{$regex:e.input,$options:"i"}},{country:{$regex:e.input,$options:"i"}}]}]},{limit:5}).fetch(),c?(c[0].e_class="blue_color",a.CITIES.remove({}),_.map(c,function(b){return a.CITIES.insert(b)})):void 0}))},"event blur .input_mobile":function(a){var b,c;c=$(a.e.currentTarget).next(),""===a.e.currentTarget.dataset.value||void 0===a.e.currentTarget.dataset.value?(a.e.currentTarget.value="",c.html("invalid. try inserting country code"),c.hide()):(b=formatInternational(a.e.currentTarget.dataset.country,a.e.currentTarget.dataset.value),a.e.currentTarget.value=a.e.currentTarget.dataset.value,c.hide())},"event keyup .input_mobile":function(a){var b,c,d,e,f,g,h,i;h=$(a.e.currentTarget).next(),h.show(),g=a.e.currentTarget.value,c=formatE164("TH",g),isValidNumber(c,"TH")?(e=formatInternational("TH",c),h.html(""+e+" valid!"),h.removeClass("warning").addClass("success"),a.e.currentTarget.dataset.value=c,a.e.currentTarget.dataset.country="TH"):g.length>=2?("+"===g.substring(0,1)?g.length>=3&&(i=g.substring(1,2)):i=g.substring(0,2),b=DATA.findOne({callingCode:i}),b?(d=formatE164(b.cca2,g),isValidNumber(d,b.cca2)?(f=formatInternational(b.cca2,d),h.html(""+f+" valid!"),h.removeClass("warning").addClass("success"),a.e.currentTarget.dataset.value=d,a.e.currentTarget.dataset.country=b.cca2):(h.html("invalid. try inserting country code"),h.removeClass("success").addClass("warning"),a.e.currentTarget.dataset.value="",a.e.currentTarget.dataset.country="")):(h.html("invalid. try inserting country code"),h.removeClass("success").addClass("warning"),a.e.currentTarget.dataset.value="",a.e.currentTarget.dataset.country="")):(h.html("invalid. try inserting country code"),h.removeClass("success").addClass("warning"),a.e.currentTarget.dataset.value="",a.e.currentTarget.dataset.country="")},"event click .submit":function(a){var b,c,d,e;b=a.t.findAll(".input_obj"),c=a.t.findAll("input"),d=a.t.findAll("select"),e=[],_.map(b,function(a){var b,c,d,f;return c=$(a).find(":input"),b={id:a.dataset.idd,arr:[]},e.push(b),f=!1,d=!1,_.map(c,function(b){var g,h;""!==b.value&&void 0!==b.value?(h=$(b).data("value"),""!==a.dataset.objt&&void 0!==a.dataset.objt?(g=c[0].selectedOptions[0].text,d=!0):g=b.name,_.isEmpty(h)?e[e.length-1].arr.push({key:g,value:b.value}):e[e.length-1].arr.push({key:g,value:h})):f=!0}),d&&e[e.length-1].arr.splice(0,1),f?e.splice(e.length-1,1):void 0}),console.log(e),Meteor.call("insert_human",e)},"event click .save_contact_json":function(){return Meteor.call("save_contact_json",function(){return console.log("json saved")})},"event click .add_contact_button_individual":function(b){var c,d,e,f;return c=b.e.currentTarget.getAttribute("data-id"),e=DATA.findOne({_id:{_str:c}}),_.extend(e,{id:e._id}),e=_.omit(e,"_id"),d=e.input,e.input[d.length-1].remove="remove_input_individual",1===e.array?a.INDIVIDUAL.insert(e):0===e.array?(f=a.INDIVIDUAL.findOne({id:e.id}),f?a.INDIVIDUAL.remove({id:e.id}):a.INDIVIDUAL.insert(e)):void 0},"event click .add_contact_button_company":function(b){var c,d,e,f;return c=b.e.currentTarget.getAttribute("data-id"),e=DATA.findOne({_id:{_str:c}}),_.extend(e,{id:e._id}),e=_.omit(e,"_id"),d=e.input,e.input[d.length-1].remove="remove_input_company",1===e.array?a.COMPANY.insert(e):0===e.array?(f=a.COMPANY.findOne({id:e.id}),f?a.COMPANY.remove({id:e.id}):a.COMPANY.insert(e)):void 0},"event click .remove_input_individual":function(b){var c,d;return c=$(b.e.currentTarget).closest("div .input_obj").data("id"),d=new Meteor.Collection.ObjectID(c),a.INDIVIDUAL.remove({_id:d})},"event click .remove_input_company":function(b){var c,d;return c=$(b.e.currentTarget).closest("div .input_obj").data("id"),d=new Meteor.Collection.ObjectID(c),a.COMPANY.remove({_id:d})},reactive_input:{_dep:new Deps.Dependency,_value:{},get:function(a){return this._dep.depend(),this._value[a]},spush:function(a,b){var c,d,e;return void 0===this._value[a]&&(this._value[a]=[]),1===b.array?this._value[a].push(b):(c=0,d=0,e=0,_.map(this._value[a],function(a){return b.input_name&&(b.input_name===a.input_name&&(e=c,d=1),c++),b.select_name?(b.select_name===a.select_name&&(e=c,d=1),c++):void 0}),0===d?this._value[a].push(b):this._value[a].splice(e,1)),this._value[a].map(function(a,b){return a.index=b,a.index}),this._dep.changed()},spop:function(a,b){return this._value[a].splice(b,1),this._value[a].map(function(a,b){return a.index=b,a.index}),this._dep.changed()}},destroy:function(){}}},display_contact:function(a){return{_template:"display_contact",init:function(){var b;return b=a.sb.init(this),a.la=this.la,a.session=!1,a.auto=this.auto,a.HUMANS=new Meteor.Collection(null,{idGeneration:"MONGO"}),b.routes&&a.sb.map_router(b.routes),b.helpers&&a.sb.map_helpers(b.helpers),b.events&&a.sb.map_event(b.events),b.mcall&&a.sb.mcall(b.mcall),b.subscribe?a.sb.subscribe(b.subscribe):void 0},"subscribe humans":function(){},"route display_contact display_contact":function(a){return a.route_this.render("display_contact")},"helper humans":function(){var a;return a=DATA.findOne({name:"humans",type:"type"}),a?DATA.find({type:a._id}):void 0},"event click .delete_human":function(b){return Meteor.call("delete_human",b.e.currentTarget.dataset.id),a.HUMANS.remove({_id:b.e.currentTarget.dataset.id})}}}},a.prototype.Sandbox={create:function(a){return{config_router:function(b){return a.core.config_iron_router(b)},map_router:function(b){return a.core.map_iron_router(b)},map_event:function(b){return a.core.meteor_event_map(b)},map_helpers:function(b){return a.core.meteor_helpers(b)},mcall:function(b){return a.core.meteor_call(b)},subscribe:function(b){return a.core.meteor_subscribe(b)},init:function(b){return a.core.init_seperator(b)},routing:function(b){return a.core.routing(b)},login:function(b){return a.core.meteor_login(b)},logout:function(b){return a.core.meteor_logout(b)},session_get:function(b){return a.core.meteor_session_get(b)},session_set:function(b){return a.core.meteor_session_set(b)},create_account:function(b){return a.core.meteor_create_account(b)},empty_child:function(b){return a.core.jquery_empty(b)},autorun:function(b){return a.core.meteor_deps_autorun(b)},user:function(b){return a.core.meteor_user(b)},get_child:function(b){return a.core.jquery_children(b)},set_attr:function(b){return a.core.jquery_attr(b)}}}},a.prototype.Core={activate_module:function(a){var b,c,d,e;return"function"==typeof a.mod&&"function"==typeof a.sb?(b={core:this},e={sb:a.sb(b)},c=a.mod(e),c.init&&"function"==typeof c.init?(d={module:c},this.start(d)):console.log("Module'"+a.mod+"' Registration : FAILED : instance has no init or destroy functions")):console.log("Module'"+a.mod+"' Registration : FAILED : one or more argument are of incorrect type")},start:function(a){return a?a.module.init():void 0},start_all:function(a){var b=this;return _.map(a.mod,function(c){var d;return d={mod:c,sb:a.sb},b.activate_module(d)})},config_iron_router:function(a){return Router.configure({layoutTemplate:a.template,before:function(){return null===Meteor.user()?(this.render("login"),this.stop()):void 0}})},map_iron_router:function(a){return _.map(a.routes,function(a){return Router.map(function(){return this.route(a.route_name,{path:a.route_path,action:function(){var b;return a.route_actions?(b={route_this:this},a.route_actions(b)):void 0}})})})},meteor_event_map:function(a){return _.map(a.events,function(b){var c,d;return c=""+b.event_name+" "+b.event_element,d={},d[c]=function(a,c){var d;return d={e:a,t:c,"this":this},b.event_actions(d)},Template[a.template].events(d)})},meteor_helpers:function(a){return _.map(a.helpers,function(b){return Template[a.template][b.helper_name]=function(a,c){var d;return d={spacebar_arg:a,spacebar_option:c},b.helper_actions(d)},Template[a.template][b.helper_name]})},meteor_call:function(a){return _.map(a.mcall,function(a){return Meteor.call(a.mcall_name,function(b,c){var d;return d={res:c},a.mcall_actions(d)})})},meteor_subscribe:function(a){return _.map(a.subscribe,function(a){return Meteor.subscribe(a.subscribe_name,[],function(){return a.subscribe_actions()})})},init_seperator:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return l={},l.events={},l.helpers={},l.routes={},l.mcall={},l.subscribe={},l.events.template=a._template,l.helpers.template=a._template,l.routes.template=a._template,l.events.events=[],l.helpers.helpers=[],l.routes.routes=[],l.mcall.mcall=[],l.subscribe.subscribe=[],b=_.keys(a),c=_.filter(b,function(a){return 0===a.indexOf("event")}),e=_.filter(b,function(a){return 0===a.indexOf("helper")}),m=_.filter(b,function(a){return 0===a.indexOf("route")}),j=_.filter(b,function(a){return 0===a.indexOf("mcall")}),o=_.filter(b,function(a){return 0===a.indexOf("subscribe")}),d=_.pick(a,c),f=_.pick(a,e),n=_.pick(a,m),k=_.pick(a,j),p=_.pick(a,o),g=0,_.map(d,function(a,b){var c;return c=b.split(" "),l.events.events[g]={event_name:c[1],event_element:c[2],event_actions:a},g++}),h=0,_.map(f,function(a,b){var c;return c=b.split(" "),l.helpers.helpers[h]={helper_name:c[1],helper_actions:a},h++}),i=0,_.map(n,function(a,b){var c;return c=b.split(" "),l.routes.routes[i]={route_name:c[1],route_path:c[2],route_actions:a},i++}),_.map(k,function(a,b){var c;return c=b.split(" "),l.mcall.mcall[i]={mcall_name:c[1],mcall_actions:a},i++}),_.map(p,function(a,b){var c;return c=b.split(" "),l.subscribe.subscribe[i]={subscribe_name:c[1],subscribe_actions:a},i++}),l},routing:function(a){var b,c,d;if(a.route_params&&null!==document.getElementById("child")&&null!==Meteor.user()){for(b=a.route_params.split("-"),c=$("#child").children().map(function(){return $(this).attr("class")}),d=0;c.length>b.length;)$("#child div:last-child").remove(),c.splice(-1,1);_.map(b,function(a){return void 0!==c?(c[d]||Template[a]&&UI.materialize(Template[a],document.getElementById("child")),d++):Template[a]?UI.materialize(Template[a],document.getElementById("child")):void 0})}return Session.set("moduleTest-rr",Router.current().path)},meteor_login:function(a){return Meteor.loginWithPassword(a.username,a.password)},meteor_logout:function(){return Meteor.logout()},meteor_session_get:function(a){return Session.get(a.p)},meteor_session_set:function(a){return Session.set(a.p,a.v)},meteor_create_account:function(a){return Accounts.createUser({username:a.username,password:a.password,email:a.email,profile:{name:a.name}})},meteor_deps_autorun:function(a){return Deps.autorun(function(){return a.actions()})},meteor_user:function(){return Meteor.user()},jquery_empty:function(a){return $(a.element).empty()},jquery_children:function(a){var b;return a.p&&a.c?b=$(a.p).children(a.c):a.p?b=$(a.p).children():a.c&&children(a.c),b},jquery_attr:function(a){var b;return a.p&&a.a&&a.v?b=$(a.p).attr(a.a,a.v):a.a&&a.v&&attr(a.a,a.v),b}},a}(),α=new ALPHA,α.Core.start_all({sb:α.Sandbox.create,mod:α.Module});